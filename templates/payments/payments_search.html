<p><h3 class="page-title">{{ _('Busca pagos a proveedores') }}</h3></p>

<div class="payments-search-panel data-panel">
  <div class="panel">
    <div class="panel-content">

      <!-- Payments Search Form -->
      <form id="payments-search">
        <div class="form-group">
          <label for="input-description">{{ _('Descripción') }}</label>
          <input type="text" id="input-description" class="form-control" placeholder="{{ _('Descripción') }}">
        </div>
        <div class="row">
          <div class="col-sm-6">
            <div class="form-group">
              <label for="input-area">{{ _('Area') }}</label>
              <select id="input-area" class="form-control" style="width: 100%">
                <option value="" disabled selected hidden>{{ _('Selecciona Area') }}</option>
              </select>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="form-group">
              <label for="input-payee">{{ _('Proveedor') }}</label>
              <select id="input-payee" class="form-control" style="width: 100%">
                <option value="" disabled selected hidden>{{ _('Selecciona Proveedor') }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="form-group data-controllers">
          <label for="input-date">{{ _('Filtra por fecha') }}</label>
          <input  type="text" id="input-date" class="form-control" data-slider-min="{{first_year}}" data-slider-max="{{last_year}}" data-slider-value="[{{first_year}}, {{last_year}}]" />
        </div>
        <button type="submit" class="btn btn-default btn-primary">{{ _('Filtrar') }}</button>
      </form>
    </div>
  </div>
</div>

<script>
  $(function () {

    var years           = {{ years }},
        areas           = {{ areas|safe }},
        payees          = {{ payees|safe }},
        payments_count  = {{ payments_count }},
        total_amount    = {{ total_amount }};

    // Add select2 ajax suport to area & payees inputs
    $('#input-area').select2({
      data: areas
    });

    $('#input-payee').select2({
      data: payees.map(function(d){
        return {
          id: d.toLowerCase(),
          text: d
        }
      })
    });

    $('#input-date').slider({
      //tooltip: 'always',
      ticks: years.map(function(d){ return parseInt(d); }),
      ticks_labels: years
    });

    $('#payments-search').submit(function(e){
      e.preventDefault();

      $.ajax({
        url: "pagos/search",
        data: {
          description: encodeURIComponent($('#input-description').val()),
          payee: encodeURIComponent($('#input-payee').val()),
          area: encodeURIComponent($('#input-area').val()),
          date: encodeURIComponent($('#input-date').val())
        },
        contentType: 'application/json; charset=utf-8',
        success: function (response) {
          drawPayments( response.areaBreakdown, response.payeeBreakdown );
        },
        error: function () {
          alert("error");
        }
      });

    });

    function drawPayments( _areaBreakdown, _payeeBreakdown ){

    }

  });
</script>